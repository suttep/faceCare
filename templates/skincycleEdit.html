{% extends "layout.html" %}

{% block title %}
    Skincycle
{% endblock %}

{% block main %}
<div class="container d-flex flex-wrap">
    <div class="head-form w-100">Skin Cycle Planner</div>
    <div class="alert alert-danger alert-register" role="alert" id="alert">
        <div class="d-flex">
            <div class="alert-text" id="alert-text"></div>
            <button onclick="closeAlert()" type="button" class="btn-close alert-close" aria-label="Close"></button>
        </div>
    </div>
    <div class="alert alert-success alert-register" role="alert" id="success">
        <div class="d-flex">
            <div class="alert-text" id="success-text"></div>
            <button onclick="closeSuccess()" type="button" class="btn-close alert-close" aria-label="Close"></button>
        </div>
    </div>
    <div class=form-card>
        <div class="head-form">Day 1</div>
        <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ routineName[0] }}" id="label1" required>
        <div class="fs-4 mb-1 mt-1">Morning Cycle</div>
        <div id="mday1-anchor">
            {% for name in mday1 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ name }}" id="mday1" required>
            {% endfor %}
            {% if skincycleLength[0] == 1 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday1">
            {% endif %}
            {% if skincycleLength[0] <= 2 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday1">
            {% endif %}
            {% if skincycleLength[0] <= 3 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday1">
            {% endif %}
            {% if skincycleLength[0] <= 4 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday1">
            {% endif %}

        </div>
        <div class="w-100 d-flex">
            <button class="btn btn-secondary mx-auto w-75 mt-2" onclick="addMore(`mday1`)">+ Skincare</button>
        </div>
        <div class="fs-4 mb-1 mt-3">Night Cycle</div>
        <div id="nday1-anchor">
            {% for name in nday1 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ name }}" id="nday1" required>
            {% endfor %}
            {% if skincycleLength[1] == 1 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday1">
            {% endif %}
            {% if skincycleLength[1] <= 2 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday1">
            {% endif %}
            {% if skincycleLength[1] <= 3 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday1">
            {% endif %}
            {% if skincycleLength[1] <= 4 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday1">
            {% endif %}
        </div>
        <div class="w-100 d-flex">
            <button class="btn btn-secondary mx-auto w-75 mt-2" onclick="addMore(`nday1`)">+ Skincare</button>
        </div>
    </div>
    <div class=form-card>
        <div class="head-form">Day 2</div>
        <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ routineName[1] }}" id="label2" required>
        <div class="fs-4 mb-1 mt-1">Morning Cycle</div>
        <div id="mday2-anchor">
            {% for name in mday2 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ name }}" id="mday2" required>
            {% endfor %}
            {% if skincycleLength[2] == 1 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday2">
            {% endif %}
            {% if skincycleLength[2] <= 2 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday2">
            {% endif %}
            {% if skincycleLength[2] <= 3 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday2">
            {% endif %}
            {% if skincycleLength[2] <= 4 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday2">
            {% endif %}
        </div>
        <div class="w-100 d-flex">
            <button class="btn btn-secondary mx-auto w-75 mt-2" onclick="addMore(`mday2`)">+ Skincare</button>
        </div>
        <div class="fs-4 mb-1 mt-3">Night Cycle</div>
        <div id="nday2-anchor">
            {% for name in nday2 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ name }}" id="nday2" required>
            {% endfor %}
            {% if skincycleLength[3] == 1 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday2">
            {% endif %}
            {% if skincycleLength[3] <= 2 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday2">
            {% endif %}
            {% if skincycleLength[3] <= 3 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday2">
            {% endif %}
            {% if skincycleLength[3] <= 4 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday2">
            {% endif %}
        </div>
        <div class="w-100 d-flex">
            <button class="btn btn-secondary mx-auto w-75 mt-2" onclick="addMore(`nday2`)">+ Skincare</button>
        </div>
    </div>
    <div class=form-card>
        <div class="head-form">Day 3</div>
        <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ routineName[2] }}" id="label3" required>
        <div class="fs-4 mb-1 mt-1">Morning Cycle</div>
        <div id="mday3-anchor">
            {% for name in mday3 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ name }}" id="mday3" required>
            {% endfor %}
            {% if skincycleLength[4] == 1 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday3">
            {% endif %}
            {% if skincycleLength[4] <= 2 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday3">
            {% endif %}
            {% if skincycleLength[4] <= 3 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday3">
            {% endif %}
            {% if skincycleLength[4] <= 4 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday3">
            {% endif %}
        </div>
        <div class="w-100 d-flex">
            <button class="btn btn-secondary mx-auto w-75 mt-2" onclick="addMore(`mday3`)">+ Skincare</button>
        </div>
        <div class="fs-4 mb-1 mt-3">Night Cycle</div>
        <div id="nday3-anchor">
            {% for name in nday3 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ name }}" id="nday3" required>
            {% endfor %}
            {% if skincycleLength[5] == 1 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday3">
            {% endif %}
            {% if skincycleLength[5] <= 2 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday3">
            {% endif %}
            {% if skincycleLength[5] <= 3 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday3">
            {% endif %}
            {% if skincycleLength[5] <= 4 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday3">
            {% endif %}
        </div>
        <div class="w-100 d-flex">
            <button class="btn btn-secondary mx-auto w-75 mt-2" onclick="addMore(`nday3`)">+ Skincare</button>
        </div>
    </div>
    <div class=form-card>
        <div class="head-form">Day 4</div>
        <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ routineName[3] }}" id="label4" required>
        <div class="fs-4 mb-1 mt-1">Morning Cycle</div>
        <div id="mday4-anchor">
            {% for name in mday4 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ name }}" id="mday4" required>
            {% endfor %}
            {% if skincycleLength[6] == 1 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday4">
            {% endif %}
            {% if skincycleLength[6] <= 2 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday4">
            {% endif %}
            {% if skincycleLength[6] <= 3 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday4">
            {% endif %}
            {% if skincycleLength[6] <= 4 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="mday4">
            {% endif %}
        </div>
        <div class="w-100 d-flex">
            <button class="btn btn-secondary mx-auto w-75 mt-2" onclick="addMore(`mday4`)">+ Skincare</button>
        </div>
        <div class="fs-4 mb-1 mt-3">Night Cycle</div>
        <div id="nday4-anchor">
            {% for name in nday4 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="{{ name }}" id="nday4" required>
            {% endfor %}
            {% if skincycleLength[7] == 1 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday4">
            {% endif %}
            {% if skincycleLength[7] <= 2 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday4">
            {% endif %}
            {% if skincycleLength[7] <= 3 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday4">
            {% endif %}
            {% if skincycleLength[7] <= 4 %}
            <input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" value="" id="nday4">
            {% endif %}
        </div>
        <div class="w-100 d-flex">
            <button class="btn btn-secondary mx-auto w-75 mt-2" onclick="addMore(`nday4`)">+ Skincare</button>
        </div>
    </div>
</div>
<div class="container">
    <button id="submitSkincycleBtn" class="btn tbl-pink mx-auto">Submit Skin Cycle</button>
</div>
<script>
var count = [
    {% if skincycleLength[0] <= 5 %}
        5,
    {% else %}
        {{ skincycleLength[0] }},
    {% endif %}
    {% if skincycleLength[1] <= 5 %}
        5,
    {% else %}
        {{ skincycleLength[1] }},
    {% endif %}
    {% if skincycleLength[2] <= 5 %}
        5,
    {% else %}
        {{ skincycleLength[2] }},
    {% endif %}
    {% if skincycleLength[3] <= 5 %}
        5,
    {% else %}
        {{ skincycleLength[3] }},
    {% endif %}
    {% if skincycleLength[4] <= 5 %}
        5,
    {% else %}
        {{ skincycleLength[4] }},
    {% endif %}
    {% if skincycleLength[5] <= 5 %}
        5,
    {% else %}
        {{ skincycleLength[5] }},
    {% endif %}
    {% if skincycleLength[6] <= 5 %}
        5,
    {% else %}
        {{ skincycleLength[6] }},
    {% endif %}
    {% if skincycleLength[7] <= 5 %}
        5
    {% else %}
        {{ skincycleLength[7] }}
    {% endif %}
    ];
function addMore(x){
    if (x == "mday1"){
        i = 0;
    } else if (x == "nday1") {
        i = 1;
    } else if (x == "mday2") {
        i = 2;
    } else if (x == "nday2") {
        i = 3;
    } else if (x == "mday3") {
        i = 4;
    } else if (x == "nday3") {
        i = 5;
    } else if (x == "mday4") {
        i = 6;
    } else if (x == "nday4") {
        i = 7;
    }
    if (count[i] == 10){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "You can only have maximum 10 skincare per routine.";
    } else {
        var d = document.getElementById( x + "-anchor");
        d.innerHTML += `<input class="form-control form-control-sm my-1 w-75 mx-auto" type="text" id="`+x+`">`;
        count[i] += 1;
    }
}
document.getElementById("submitSkincycleBtn").addEventListener("click", function(event){
    var formSkinCycle = new FormData();
    var i;
    document.getElementById("submitSkincycleBtn").disabled = true;
    var mday1 = document.querySelectorAll("#mday1");
    var dailyCounter = 0;
    for (i = 0; i < mday1.length; i++) {
        if (mday1[i].value.length != 0){
            formSkinCycle.append("mday1",mday1[i].value);
            dailyCounter += 1;
        }
    }
    if (dailyCounter == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every day must have atleast 1 routine.";
        document.getElementById("mday1").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
        return
    } else {
        dailyCounter = 0;
    }

    var nday1 = document.querySelectorAll("#nday1");
    for (i = 0; i < nday1.length; i++) {
        if (nday1[i].value.length != 0){
            formSkinCycle.append("nday1",nday1[i].value);
            dailyCounter += 1;
        }
    }
    if (dailyCounter == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every day must have atleast 1 routine.";
        document.getElementById("nday1").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
        return
    } else {
        dailyCounter = 0;
    }

    var mday2 = document.querySelectorAll("#mday2");
    for (i = 0; i < mday2.length; i++) {
        if (mday2[i].value.length != 0){
            formSkinCycle.append("mday2",mday2[i].value);
            dailyCounter += 1;
        }
    }
    if (dailyCounter == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every day must have atleast 1 routine.";
        document.getElementById("mday2").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
        return
    } else {
        dailyCounter = 0;
    }

    var nday2 = document.querySelectorAll("#nday2");
    for (i = 0; i < nday2.length; i++) {
        if (nday2[i].value.length != 0){
            formSkinCycle.append("nday2",nday2[i].value);
            dailyCounter += 1;
        }
    }
    if (dailyCounter == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every day must have atleast 1 routine.";
        document.getElementById("nday2").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
        return
    } else {
        dailyCounter = 0;
    }

    var mday3 = document.querySelectorAll("#mday3");
    for (i = 0; i < mday3.length; i++) {
        if (mday3[i].value.length != 0){
            formSkinCycle.append("mday3",mday3[i].value);
            dailyCounter += 1;
        }
    }
    if (dailyCounter == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every day must have atleast 1 routine.";
        document.getElementById("mday3").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
        return
    } else {
        dailyCounter = 0;
    }

    var nday3 = document.querySelectorAll("#nday3");
    for (i = 0; i < nday3.length; i++) {
        if (nday3[i].value.length != 0){
            formSkinCycle.append("nday3",nday3[i].value);
            dailyCounter += 1;
        }
    }
    if (dailyCounter == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every day must have atleast 1 routine.";
        document.getElementById("nday3").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
        return
    } else {
        dailyCounter = 0;
    }

    var mday4 = document.querySelectorAll("#mday4");
    for (i = 0; i < mday4.length; i++) {
        if (mday4[i].value.length != 0){
            formSkinCycle.append("mday4",mday4[i].value);
            dailyCounter += 1;
        }
    }
    if (dailyCounter == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every day must have atleast 1 routine.";
        document.getElementById("mday4").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
        return
    } else {
        dailyCounter = 0;
    }

    var nday4 = document.querySelectorAll("#nday4");
    for (i = 0; i < nday4.length; i++) {
        if (nday4[i].value.length != 0){
            formSkinCycle.append("nday4",nday4[i].value);
            dailyCounter += 1;
        }
    }
    if (dailyCounter == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every day must have atleast 1 routine.";
        document.getElementById("nday4").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
        return
    } else {
        dailyCounter = 0;
    }

    var label1 = document.getElementById("label1").value;
    if (label1.length == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every cycle must have name.";
        document.getElementById("label1").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
    } else {
        formSkinCycle.append("label1",label1);
    }

    var label2 = document.getElementById("label2").value;
    if (label2.length == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every cycle must have name.";
        document.getElementById("label2").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
    } else {
        formSkinCycle.append("label2",label2);
    }

    var label3 = document.getElementById("label3").value;
    if (label3.length == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every cycle must have name.";
        document.getElementById("label3").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
    } else {
        formSkinCycle.append("label3",label3);
    }

    var label4 = document.getElementById("label4").value;
    if (label4.length == 0){
        document.getElementById("alert").style.display = "block";
        document.getElementById("alert-text").innerHTML = "Every cycle must have name.";
        document.getElementById("label4").focus();
        document.getElementById("submitSkincycleBtn").disabled = false;
    } else {
        formSkinCycle.append("label4",label4);
    }
    fetch(`/edit-skincycle`, {
        method: "POST",
        body: formSkinCycle,
        }).then((response) => response.json())
        .then((data) => {
            if(data.status == "success"){
                document.getElementById("success").style.display = "block";
                document.getElementById("success-text").innerHTML = data.desc;
                document.getElementById("submitSkincycleBtn").disabled = false;
            } else {
                document.getElementById("alert").style.display = "block";
                document.getElementById("alert-text").innerHTML = "An error has occurred.";
            }
        })
});

function closeAlert(){
    document.getElementById("alert").style.display = "none";
}
function closeSuccess(){
    document.getElementById("success").style.display = "none";
}
</script>
{% endblock %}
